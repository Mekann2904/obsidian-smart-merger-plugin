# SmartMerger with Progress Plugin

## 概要
**SmartMerger with Progress Plugin** は、Obsidian の保管庫内にある全ての Markdown ファイルを自動的に結合し、ひとつまたは複数の統合ファイルに出力するプラグインです。  
各ファイルの内容にはファイル名を見出しとして挿入し、マージ処理中は進捗情報（処理中のファイル名や進捗率）がステータスバーにテキスト形式で表示されます。  
出力ファイル名はプラグイン名と実行日時、さらにパート番号を組み合わせることで、既存ファイルとの重複を防止しています。また、出力する内容が大きくなりすぎないよう、一定サイズ（例：10MB）ごとに自動的にファイルを分割します。

## 主な機能
- **Markdown ファイルの自動結合**  
  保管庫内の全 Markdown ファイルを読み込み、各ファイルの内容を統合します。  
  ※ 各ファイルの先頭には `## ファイル名` の見出しを追加し、元のファイルがどれかを明示します。

- **進捗表示**  
  マージ処理中は、現在処理中のファイル名や全体の進捗状況をステータスバーにテキスト表示します。

- **出力ファイルの自動分割**  
  マージ済みのコンテンツが一定サイズ（例：10MB）を超えた場合、内容を自動的に複数ファイルに分割し、メモリ使用量の過剰な増加を防ぎます。

- **ファイル名の重複防止**  
  出力ファイルは `SmartMerger_YYYYMMDD_HHMMSS_partX.md` という形式で保存されるため、同じ名前のファイルが上書きされるリスクを軽減します。

- **外部フォルダへの出力（デスクトップ版）**  
  設定から出力先を「Vault 内 / 外部フォルダ / 両方」から選択できます。外部出力先を指定すると、Vault の外の任意フォルダへも同名で保存します（同名が存在する場合は `(1)`, `(2)` を付与して回避）。

## インストール方法
1. このリポジトリをクローンまたは ZIP ダウンロードしてください。
2. ダウンロードしたプラグインフォルダを、対象の Obsidian Vault 内の `.obsidian/plugins/` ディレクトリに配置します。
3. Obsidian を再起動するか、設定画面からプラグインをリロードしてください。
4. Obsidian の「設定」>「プラグイン」から **SmartMerger with Progress Plugin** を有効にします。

## 使い方
1. Obsidian 内のコマンドパレット（`Ctrl+P` または `Cmd+P`）を開きます。
2. 「Smart Merger with Progress」コマンドを選択します。
3. プラグインが保管庫内の Markdown ファイルを順次読み込み、統合処理を開始します。  
   処理中は、ステータスバーに進捗情報が表示されます。
4. 処理完了後、出力された統合ファイル（例：`SmartMerger_20250223_153045_part1.md` など）が作成され、通知が表示されます。

### 外部出力の設定
1. Obsidian の「設定 > コミュニティプラグイン > SmartMerger 設定」を開きます。
2. 「出力先」で「外部フォルダ」または「両方」を選びます。
3. 「外部出力フォルダ」に絶対パス（例: `/Users/you/Exports`）を入力して保存します。
   - デスクトップ版のみ対応（モバイルは未対応）。

## カスタマイズ
- **MAX_CONTENT_LENGTH**  
  出力ファイルの分割サイズの上限（例：10MB）を定義している定数です。  
  必要に応じて `main.ts` 内のこの値を変更してください。

## 注意事項
- このプラグインは既存のファイルを削除や上書きは行いません。  
- 出力ファイル名は自動生成され、重複を防止する仕組みになっています。  
- 大量のファイルを処理する場合、統合処理に時間がかかることがありますのでご注意ください。
- 外部フォルダ出力は Obsidian デスクトップ版（Node.js の `fs` 利用可能環境）のみ動作します。モバイル環境では Vault 内出力にフォールバックしてください。

## 既知の問題 / 今後の改善点
- 分割サイズの動的調整機能の検討

## ライセンス
MIT License

## クレジット
- **開発者:** Mekann  
- 本プラグインは Obsidian Plugin API を利用して開発されています。
